**Модуль 24. Практическая работа**

**Цель практической работы**

Освоить функционал EFK-стека, научиться описывать настройки для инструментов данного стека, построить дашборд в Kibana.

**Что входит в работу**

- Описать docker-контейнеры gunicorn + fluentd + elasticsearch + kibana, используя драйвер docker - fluentd
- Описать настройки для логов gunicorn, fluentd
- Построить дашборд в Kibana

**Задание 1. Описание docker-контейнеров**

**Что нужно сделать**

1. Описать docker-контейнеры для flask-приложения, развернутого с помощью gunicorn, fluentd, elasticsearch и kibana.
2. Во flask-приложении опишите 6 роутов (/one, /two, .., /five, /error
, где роуты возвращают HTTP-коды состояния 201, 202,..., 205, 500 соответственно)

**Советы и рекомендации**

Вы можете воспользоваться кодом из репозитория [docker-elk](https://github.com/deviantony/docker-elk), заменив при этом logstash на fluentd. Также, вы можете воспользоваться [примером](https://docs.fluentd.org/container-deployment/docker-compose) из документации fluentd

**Что оценивается**

Умение описывать docker-контейнеры для использования EFK-стека в связке с gunicorn.

**Задание 2. Описание настроек логов и fluentd**

**Что нужно сделать**

1. Опишите конфиг логов для gunicorn.access, чтобы они писали в stdout приложения
2. Опишите конфиг для fluentd, чтобы он забирал логи из stdout
 контейнеров и передавал в elasticsearch. Также необходимо описать шаблон для обработки gunicorn.access логов, используя [fluentd grok plugin](https://github.com/fluent/fluent-plugin-grok-parser).

**Советы и рекомендации**

Конфиг для логов gunicorn вы можете взять из занятия 2: docker-elk/app/log\_2.conf и переписать его под вывод логов в stdout.

**Что оценивается**

Понимание, как происходит взаимодействие между gunicorn и fluentd, умение описывать конфиги и работать с плагинами fluentd

**Задание 3. Построение дашборда в Kibana**

**Что нужно сделать:**

1. Построить дашборд на основе данных из логов gunicorn.access. Отобразите 3 графических компонентов:

   1. Топ-5 самых посещаемых эндпоинтов
   1. Счетчик посещений сайта
   1. Топ-5 кодов состояния HTTP

**Советы и рекомендации.**

Для проверки построение дашборда необходимо сделать скриншот и положить его в корень вашего проекта. 

[Пример](https://blog.ruanbekker.com/blog/2019/04/02/setup-kibana-dashboards-for-nginx-log-data-to-understand-the-behavior/) работы с Kibana. 

**Что оценивается**

Понимание, как использовать индексы elasticsearch в Kibana, как отображать графические компоненты и создавать дашборд

**Как отправить работу на проверку**

Выполните домашнее задание в GitLab, в форме ниже напишите «Сделано» и нажмите кнопку «Отправить».


